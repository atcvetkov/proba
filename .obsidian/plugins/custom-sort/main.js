/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var B=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var Ge=Object.prototype.hasOwnProperty;var Ve=(t,e)=>{for(var r in e)B(t,r,{get:e[r],enumerable:!0})},ze=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of We(e))!Ge.call(t,i)&&i!==r&&B(t,i,{get:()=>e[i],enumerable:!(n=_e(e,i))||n.enumerable});return t};var He=t=>ze(B({},"__esModule",{value:!0}),t);var Ot={};Ve(Ot,{default:()=>U});module.exports=He(Ot);var f=require("obsidian");function le(t,e){let r=Object.keys(e).map(n=>ke(t,n,e[n]));return r.length===1?r[0]:function(){r.forEach(n=>n())}}function ke(t,e,r){let n=t[e],i=t.hasOwnProperty(e),o=r(n);return n&&Object.setPrototypeOf(o,n),Object.setPrototypeOf(s,o),t[e]=s,a;function s(...l){return o===n&&t[e]===s&&a(),o.apply(this,l)}function a(){t[e]===s&&(i?t[e]=n:delete t[e]),o!==n&&(o=n,Object.setPrototypeOf(s,n||Function))}}var X=require("obsidian");function b(t){return t!=null}function I(t){return(t==null?void 0:t.length)>0?t[t.length-1]:void 0}var T=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!0}).compare,Z={[1]:(t,e)=>T(t.sortString,e.sortString),[2]:(t,e)=>T(e.sortString,t.sortString),[3]:(t,e)=>t.isFolder&&e.isFolder?T(t.sortString,e.sortString):t.mtime-e.mtime,[4]:(t,e)=>t.mtime-e.mtime,[5]:(t,e)=>t.isFolder&&e.isFolder?T(t.sortString,e.sortString):e.mtime-t.mtime,[6]:(t,e)=>e.mtime-t.mtime,[7]:(t,e)=>t.isFolder&&e.isFolder?T(t.sortString,e.sortString):t.ctimeNewest-e.ctimeNewest,[8]:(t,e)=>t.ctimeNewest-e.ctimeNewest,[9]:(t,e)=>t.isFolder&&e.isFolder?T(t.sortString,e.sortString):e.ctimeOldest-t.ctimeOldest,[10]:(t,e)=>e.ctimeOldest-t.ctimeOldest,[11]:(t,e)=>T(t.sortString,e.sortString)};function Ue(t,e,r){var n,i;if(t.groupIdx!=null&&e.groupIdx!=null)if(t.groupIdx===e.groupIdx){let o=r.groups[t.groupIdx];return(o==null?void 0:o.regexSpec)&&o.secondaryOrder&&t.matchGroup===e.matchGroup?Z[(n=o.secondaryOrder)!=null?n:1](t,e):Z[(i=o==null?void 0:o.order)!=null?i:1](t,e)}else return t.groupIdx-e.groupIdx;else return Z[1](t,e)}var ue=t=>!!t.isRoot,pe=0,j=0,Be=function(t,e){var c,p,h,m,E,d,re,ie,ne,oe,se,ae;let r,n=!1,i,o=ue(t),s=!o,a=t,l=o?t.name:a.basename;for(r=0;r<e.groups.length;r++){i=null;let g=e.groups[r];if(g.foldersOnly&&s||g.filesOnly&&o)continue;let S=g.matchFilenameWithExt?t.name:l;switch(g.type){case 3:if(g.exactPrefix)S.startsWith(g.exactPrefix)&&(n=!0);else{let x=(c=g.regexSpec)==null?void 0:c.regex.exec(S);x&&(n=!0,i=(p=g.regexSpec)==null?void 0:p.normalizerFn(x[1]))}break;case 4:if(g.exactSuffix)S.endsWith(g.exactSuffix)&&(n=!0);else{let x=(h=g.regexSpec)==null?void 0:h.regex.exec(S);x&&(n=!0,i=(m=g.regexSpec)==null?void 0:m.normalizerFn(x[1]))}break;case 5:if(g.exactPrefix&&g.exactSuffix)S.length>=g.exactPrefix.length+g.exactSuffix.length&&S.startsWith(g.exactPrefix)&&S.endsWith(g.exactSuffix)&&(n=!0);else if(g.exactPrefix&&S.startsWith(g.exactPrefix)||g.exactSuffix&&S.endsWith(g.exactSuffix)){let x=(E=g.regexSpec)==null?void 0:E.regex.exec(S);if(x){let we=x[0];i=(d=g.regexSpec)==null?void 0:d.normalizerFn(x[1]),we.length+((ie=(re=g.exactPrefix)==null?void 0:re.length)!=null?ie:0)+((oe=(ne=g.exactSuffix)==null?void 0:ne.length)!=null?oe:0)<=S.length?n=!0:i=null}}break;case 2:if(g.exactText)S===g.exactText&&(n=!0);else{let x=(se=g.regexSpec)==null?void 0:se.regex.exec(S);x&&(n=!0,i=(ae=g.regexSpec)==null?void 0:ae.normalizerFn(x[1]))}break;case 1:n=!0;break}if(n)break}let u=r;return n||(b(e.outsidersFilesGroupIdx)&&s?u=e.outsidersFilesGroupIdx:b(e.outsidersFoldersGroupIdx)&&o?u=e.outsidersFoldersGroupIdx:b(e.outsidersGroupIdx)&&(u=e.outsidersGroupIdx)),{groupIdx:u,sortString:i?i+"//"+t.name:t.name,matchGroup:i!=null?i:void 0,isFolder:o,folder:o?t:void 0,path:t.path,ctimeNewest:s?a.stat.ctime:j,ctimeOldest:s?a.stat.ctime:j,mtime:s?a.stat.mtime:pe}},de=new Set([4,6,8,10]),Ze=(t,e)=>de.has(t!=null?t:11)||de.has(e!=null?e:11),Xe=(t,e)=>{let r=pe,n=j,i=e;return t.children.forEach(o=>{if(!ue(o)){let s=o;s.stat.mtime>r&&(r=s.stat.mtime),s.stat.ctime>n&&(n=s.stat.ctime),s.stat.ctime<i&&(i=s.stat.ctime)}}),[r,n,i]},je=(t,e,r={})=>{let n=Date.now();t.forEach(i=>{let o=i.groupIdx;if(o!==void 0&&r[o]>1){let s=e.groups[o].order;Ze(s)&&i.folder&&([i.mtime,i.ctimeNewest,i.ctimeOldest]=Xe(i.folder,n))}})},ge=function(t,e){let r=this.fileExplorer,n={},i=(t.itemsToHide?this.file.children.filter(s=>!t.itemsToHide.has(s.name)):this.file.children).map(s=>{var u;let a=Be(s,t),l=a.groupIdx;return l!==void 0&&(n[l]=1+((u=n[l])!=null?u:0)),a});je(i,t,n),i.sort(function(s,a){return Ue(s,a,t)});let o=i.map(s=>r.fileItems[s.path]);X.requireApiVersion&&(0,X.requireApiVersion)("0.15.0")?this.vChildren.setChildren(o):this.children=o};var me=" *([MDCLXVI]+)";var he=" *([MDCLXVI]+(?:\\.[MDCLXVI]+)*)";var Se=" *([MDCLXVI]+(?:-[MDCLXVI]+)*)";var xe=" *(\\d+)";var be=" *(\\d+(?:\\.\\d+)*)";var Fe=" *(\\d+(?:-\\d+)*)",Y=".",K="-";var Ce="|";function P(t,e){if(t.length<e){let r=e-t.length;return"000000000000000000000000000".substr(0,r)+t}else return t}function M(t="",e,r){return e?`${t.split(e).filter(i=>i).map(i=>P(i,r!=null?r:8)).join(Ce)}//`:`${P(t,r!=null?r:8)}//`}function q(t){let e="0iIvVxXlLcCdDmM",r=[0,1,1,5,5,10,10,50,50,100,100,500,500,1e3,1e3];if(t){let n=e.indexOf(t[0]);return n>0?r[n]:0}else return 0}function fe(t){if(t==null)return"0";let e=q(t.charAt(0)),r,n;for(let i=1;i<t.length;i++)n=q(t.charAt(i)),r=q(t.charAt(i-1)),n<=r?e+=n:e=e-r*2+n;return`${e}`}function v(t,e,r){return e?`${t.split(e).filter(i=>i).map(i=>P(fe(i),r!=null?r:8)).join(Ce)}//`:`${P(fe(t),r!=null?r:8)}//`}var qe="/",D="...",Te="*",_=`/${D}`,W=`/${D}/`,G=`/${Te}`,ye=t=>t.split(qe).filter(e=>!!e),w=class{constructor(){this.tree={subtree:{}};this.determinedWildcardRules={};this.addWildcardDefinition=(e,r)=>{let n=ye(e),i=n.pop();if(i!==Te&&i!==D)return null;let o=this.tree;if(n.forEach(s=>{let a=o.subtree[s];if(a)o=a;else{let l={name:s,subtree:{}};o.subtree[s]=l,o=l}}),i===D){if(o.matchChildren)return{errorMsg:`Duplicate wildcard '${i}' specification for ${e}`};o.matchChildren=r}else{if(o.matchAll)return{errorMsg:`Duplicate wildcard '${i}' specification for ${e}`};o.matchAll=r}};this.folderMatch=e=>{var n,i,o;let r=this.determinedWildcardRules[e];if(r)return(n=r.spec)!=null?n:null;{let s=this.tree.matchChildren,a=this.tree.matchAll,l=ye(e),u=this.tree,c=l.length-1;for(let p=0;p<=c;p++){let h=l[p],m=u.subtree[h];if(m)u=m,s=(i=m==null?void 0:m.matchChildren)!=null?i:null,a=(o=m.matchAll)!=null?o:a;else{p<c&&(s=a);break}}return s=s!=null?s:a,s?(this.determinedWildcardRules[e]={spec:s},s):(this.determinedWildcardRules[e]={},null)}}}};var Oe=(d=>(d[d.SyntaxError=0]="SyntaxError",d[d.SyntaxErrorInGroupSpec=1]="SyntaxErrorInGroupSpec",d[d.DuplicateSortSpecForSameFolder=2]="DuplicateSortSpecForSameFolder",d[d.DuplicateOrderAttr=3]="DuplicateOrderAttr",d[d.DanglingOrderAttr=4]="DanglingOrderAttr",d[d.MissingAttributeValue=5]="MissingAttributeValue",d[d.NoSpaceBetweenAttributeAndValue=6]="NoSpaceBetweenAttributeAndValue",d[d.InvalidAttributeValue=7]="InvalidAttributeValue",d[d.TargetFolderNestedSpec=8]="TargetFolderNestedSpec",d[d.TooManyNumericSortingSymbols=9]="TooManyNumericSortingSymbols",d[d.NumericalSymbolAdjacentToWildcard=10]="NumericalSymbolAdjacentToWildcard",d[d.ItemToHideExactNameWithExtRequired=11]="ItemToHideExactNameWithExtRequired",d[d.ItemToHideNoSupportForThreeDots=12]="ItemToHideNoSupportForThreeDots",d[d.DuplicateWildcardSortSpecForSameFolder=13]="DuplicateWildcardSortSpecForSameFolder",d[d.StandardObsidianSortAllowedOnlyAtFolderLevel=14]="StandardObsidianSortAllowedOnlyAtFolderLevel",d))(Oe||{}),Ye=new Set([2,13]),C="...",J=C.length,Ke=1,Je={"a-z":{asc:1,desc:2},created:{asc:7,desc:9},modified:{asc:3,desc:5},"advanced modified":{asc:4,desc:6},"advanced created":{asc:8,desc:10},"a-z, created":{asc:1,desc:2,secondary:7},"a-z, created desc":{asc:1,desc:2,secondary:9},"a-z, modified":{asc:1,desc:2,secondary:3},"a-z, modified desc":{asc:1,desc:2,secondary:5},"a-z, advanced created":{asc:1,desc:2,secondary:8},"a-z, advanced created desc":{asc:1,desc:2,secondary:10},"a-z, advanced modified":{asc:1,desc:2,secondary:4},"a-z, advanced modified desc":{asc:1,desc:2,secondary:6}};var Ae={"target-folder:":1,"order-asc:":2,"order-desc:":3,"sorting:":4,"::::":1,"<":2,"\\<":2,">":3,"\\>":3},Ee=".",Qe="/:files",et="/:",tt="/:files.",rt="/:.",it="/folders",nt="/",ot="%",st="--%",at="/--hide:",lt="//",Q={[et]:{filesOnly:!0},[Qe]:{filesOnly:!0},[rt]:{filesOnly:!0,filenameWithExt:!0},[tt]:{filesOnly:!0,filenameWithExt:!0},[nt]:{foldersOnly:!0},[it]:{foldersOnly:!0},[ot]:{},[st]:{itemToHide:!0},[at]:{itemToHide:!0}},F=t=>t===C,ee=t=>t.indexOf(C)!==-1,Ie="\\R+",Re="\\.R+",Le="\\-R+",Ne="\\d+",Pe="\\.d+",Me="\\-d+",dt=/[\^$.\-+\[\]{}()|*?=!\\]/g,y=t=>t.replace(dt,"\\$&"),ct=[y(Ne),y(Ie),y(Pe),y(Me),y(Re),y(Le)],A=new RegExp(ct.join("|"),"gi"),ut=t=>(A.lastIndex=0,A.test(t)&&A.test(t)),pt=t=>(A.lastIndex=0,A.test(t)),gt=t=>{if(t){A.lastIndex=0;let e=A.exec(t);return e?e[0]:null}else return null},ft=t=>v(t),mt=t=>v(t,Y),ht=t=>v(t,K),St=t=>M(t),xt=t=>M(t,Y),bt=t=>M(t,K),Ft={[Ie.toLowerCase()]:{regexpStr:me,normalizerFn:ft},[Re.toLowerCase()]:{regexpStr:he,normalizerFn:mt},[Le.toLowerCase()]:{regexpStr:Se,normalizerFn:ht},[Ne.toLowerCase()]:{regexpStr:xe,normalizerFn:St},[Pe.toLowerCase()]:{regexpStr:be,normalizerFn:xt},[Me.toLowerCase()]:{regexpStr:Fe,normalizerFn:bt}};var R=(t,e)=>{let r=gt(t);if(r){let n=Ft[r.toLowerCase()],[i,o]=t.split(r),s=e===1||e===3?"^":"",a=e===2||e===3?"$":"";return{regexpSpec:{regex:new RegExp(`${s}${y(i)}${n.regexpStr}${y(o)}${a}`,"i"),normalizerFn:n.normalizerFn},prefix:i,suffix:o}}else return null},V=t=>({noPrefix:t.prefix.length===0,noSuffix:t.suffix.length===0}),Ct=t=>t.endsWith(_)||t.endsWith(W)||t.endsWith(G);var yt=t=>t.endsWith(G)?(t=t.slice(0,-G.length),[t.length>0?t:"/",3]):t.endsWith(_)?(t=t.slice(0,-_.length),[t.length>0?t:"/",2]):t.endsWith(W)?(t=t.slice(0,-W.length),[t.length>0?t:"/",2]):[t,1],z="Numerical sorting symbol must not be directly adjacent to a wildcard because of potential performance problem. An additional explicit separator helps in such case.",H=class{constructor(e){this.errorLogger=e;this.pathMatchPriorityForPath={};this.problem=(e,r)=>{var a;let n=Oe[e],i=(a=this.errorLogger)!=null?a:console.error,o=!Ye.has(e),s=o?` line ${this.currentEntryLineIdx} of`:"";i(`Sorting specification problem: ${e}:${n} ${r} ---encountered in${s} sorting spec in file ${this.currentSortingSpecContainerFilePath}`),s&&i(`Content of problematic line: "${this.currentEntryLine}"`),this.recentErrorMessage=`File: ${this.currentSortingSpecContainerFilePath}
`+(o?`Specification line #${this.currentEntryLineIdx}: "${this.currentEntryLine}"
`:"")+`Problem: ${e}:${n}
Details: ${r}`,this.problemAlreadyReportedForCurrentLine=!0};this.parseAttribute=e=>{let r=e.trimStart(),n=e.length-r.length,i=r.indexOf(" ");if(i===-1)return null;let o=r.substring(0,i),s=o.toLowerCase(),a=Ae[s];if(a){let l=r.substring(i).trim();if(l){let u=this.attrValueValidators[a];if(u){let c=u(l);if(c)return{nesting:n,attribute:a,value:c};this.problem(7,`Invalid value of the attribute "${o}"`)}else return{nesting:n,attribute:a,value:l}}else this.problem(5,`Attribute "${o}" requires a value to follow`)}return null};this.checkForRiskyAttrSyntaxError=e=>{let r=e.trimStart(),n=r.toLowerCase();for(let i of Object.keys(Ae))if(n.startsWith(i)){let o=r.substr(0,i.length);return n.length===i.length?(this.problem(5,`Attribute "${o}" requires a value to follow`),!0):(this.problem(6,`Space required after attribute name "${o}"`),!0)}return!1};this.parseSortingGroupSpec=e=>{let r=e.trim();if(ut(r))return this.problem(9,"Maximum one numeric sorting indicator allowed per line"),null;let n=Q[r];if(n)return n.itemToHide?(this.problem(11,"Exact name with ext of file or folders to hide is required"),null):{outsidersGroup:!0,filesOnly:n.filesOnly,foldersOnly:n.foldersOnly};for(let i of Object.keys(Q))if(r.startsWith(i+" ")){let o=Q[i];return o.itemToHide?{itemToHide:!0,plainSpec:r.substring(i.length+1),filesOnly:o.filesOnly,foldersOnly:o.foldersOnly}:{plainSpec:r.substring(i.length+1),filesOnly:o.filesOnly,foldersOnly:o.foldersOnly,matchFilenameWithExt:o.filenameWithExt}}return null};this.validateTargetFolderAttrValue=e=>{if(e){let r=e.trim();return r||null}else return null};this.internalValidateOrderAttrValue=e=>(e=e.trim(),e?Je[e.toLowerCase()]:null);this.validateOrderAscAttrValue=e=>{let r=this.internalValidateOrderAttrValue(e);return r?{order:r.asc,secondaryOrder:r.secondary}:null};this.validateOrderDescAttrValue=e=>{let r=this.internalValidateOrderAttrValue(e);return r?{order:r.desc,secondaryOrder:r.secondary}:null};this.validateSortingAttrValue=e=>e.trim().toLowerCase()==="standard"?{order:11}:null;this.attrValueValidators={[1]:this.validateTargetFolderAttrValue.bind(this),[2]:this.validateOrderAscAttrValue.bind(this),[3]:this.validateOrderDescAttrValue.bind(this),[4]:this.validateSortingAttrValue.bind(this)};this.convertPlainStringSortingGroupSpecToArraySpec=e=>{if(e=e.trim(),F(e))return[C];if(e.startsWith(C))return[C,e.substr(J)];if(e.endsWith(C))return[e.substring(0,e.length-J),C];let r=e.indexOf(C);return r>0?[e.substring(0,r),C,e.substr(r+J)]:[e]};this.consumeParsedSortingGroupSpec=e=>{var r,n,i;if(e.outsidersGroup)return{type:0,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt};if(((r=e.arraySpec)==null?void 0:r.length)===1){let o=e.arraySpec[0];return F(o)?{type:1,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:{type:2,exactText:e.arraySpec[0],filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}if(((n=e.arraySpec)==null?void 0:n.length)===2){let o=e.arraySpec[0],s=e.arraySpec[1];return F(o)&&!F(s)&&!ee(s)?{type:4,exactSuffix:s,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:!F(o)&&F(s)&&!ee(o)?{type:3,exactPrefix:o,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:(this.problem(1,"three dots occurring more than once and no more text specified"),null)}if(((i=e.arraySpec)==null?void 0:i.length)===3){let o=e.arraySpec[0],s=e.arraySpec[1],a=e.arraySpec[2];return F(s)&&!F(o)&&!F(a)&&!ee(a)?{type:5,exactPrefix:o,exactSuffix:a,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:(this.problem(1,"three dots occurring more than once or unrecognized specification of sorting rule"),null)}return this.problem(1,"Unrecognized specification of sorting rule"),null};this.adjustSortingGroupForNumericSortingSymbol=e=>{switch(e.type){case 3:let r=R(e.exactPrefix,1);if(r){if(V(r).noSuffix)return this.problem(10,z),!1;delete e.exactPrefix,e.regexSpec=r.regexpSpec}break;case 4:let n=R(e.exactSuffix,2);if(n){if(V(n).noPrefix)return this.problem(10,z),!1;delete e.exactSuffix,e.regexSpec=n.regexpSpec}break;case 5:let i=R(e.exactPrefix,1);if(i){if(V(i).noSuffix)return this.problem(10,z),!1;delete e.exactPrefix,e.regexSpec=i.regexpSpec}else{let s=R(e.exactSuffix,2);if(s){if(V(s).noPrefix)return this.problem(10,z),!1;delete e.exactSuffix,e.regexSpec=s.regexpSpec}}break;case 2:let o=R(e.exactText,3);o&&(delete e.exactText,e.regexSpec=o.regexpSpec);break}return!0}}parseSortSpecFromText(e,r,n,i){this.ctx={folderPath:r,specs:[]},this.currentEntryLine=null,this.currentEntryLineIdx=null,this.currentSortingSpecContainerFilePath=null,this.problemAlreadyReportedForCurrentLine=null,this.recentErrorMessage=null;let o=!1,s=0;for(let a of e){s++,this.currentEntryLine=a,this.currentEntryLineIdx=s,this.currentSortingSpecContainerFilePath=`${r==="/"?"":r}/${n}`,this.problemAlreadyReportedForCurrentLine=!1;let l=a.trim();if(l===""||l.startsWith(lt))continue;o=!1;let u=this.parseAttribute(a);if(u)o=this.processParsedSortingAttribute(u),this.ctx.previousValidEntryWasTargetFolderAttr=o&&u.attribute===1;else if(!this.problemAlreadyReportedForCurrentLine&&!this.checkForRiskyAttrSyntaxError(a)){let c=this.parseSortingGroupSpec(a);!this.problemAlreadyReportedForCurrentLine&&!c&&(c={plainSpec:l}),c&&(o=this.processParsedSortGroupSpec(c)),this.ctx.previousValidEntryWasTargetFolderAttr=void 0}if(!o){this.problemAlreadyReportedForCurrentLine||this.problem(0,"Sorting specification line doesn't match any supported syntax");break}}if(o){if(this.ctx.specs.length>0){for(let l of this.ctx.specs)this.postprocessSortSpec(l);let a;for(let l of this.ctx.specs)for(let u=0;u<l.targetFoldersPaths.length;u++){let c=l.targetFoldersPaths[u];if(Ct(c)){a=a!=null?a:new w;let p=a.addWildcardDefinition(c,l);if(p!=null&&p.errorMsg)return this.problem(13,p==null?void 0:p.errorMsg),null}}a&&(i=i!=null?i:{sortSpecByPath:{}},i.sortSpecByWildcard=a);for(let l of this.ctx.specs)for(let u=0;u<l.targetFoldersPaths.length;u++){let c=l.targetFoldersPaths[u];i=i!=null?i:{sortSpecByPath:{}};let p,h;[h,p]=yt(c);let m=!0,E=this.pathMatchPriorityForPath[h];if(E){if(E===1&&p===1)return this.problem(2,`Duplicate sorting spec for folder ${h}`),null;p>=E&&(m=!1)}m&&(i.sortSpecByPath[h]=l,this.pathMatchPriorityForPath[h]=p)}}return i}else return null}processParsedSortingAttribute(e){if(e.attribute===1)return e.nesting===0?(this.ctx.previousValidEntryWasTargetFolderAttr?this.ctx.currentSpec?this.ctx.currentSpec.targetFoldersPaths.push(e.value):this.ctx.currentSpec=this.putNewSpecForNewTargetFolder(e.value):this.ctx.currentSpec=this.putNewSpecForNewTargetFolder(e.value),!0):(this.problem(8,"Nested (indented) specification of target folder is not allowed"),!1);if(e.attribute===2||e.attribute===3||e.attribute===4){if(e.nesting===0){if(this.ctx.currentSpec||(this.ctx.currentSpec=this.putNewSpecForNewTargetFolder()),this.ctx.currentSpec.defaultOrder){let r=this.ctx.currentSpec.targetFoldersPaths.join(" :: ");return this.problem(3,`Duplicate order specification for folder(s) ${r}`),!1}return this.ctx.currentSpec.defaultOrder=e.value.order,!0}else if(e.nesting>0){if(!this.ctx.currentSpec||!this.ctx.currentSpecGroup)return this.problem(4,"Nested (indented) attribute requires prior sorting group definition"),!1;if(this.ctx.currentSpecGroup.order){let r=this.ctx.currentSpec.targetFoldersPaths.join(" :: ");return this.problem(3,`Duplicate order specification for a sorting rule of folder ${r}`),!1}return e.value.order===11?(this.problem(14,"The standard Obsidian sort order is only allowed at a folder level (not nested syntax)"),!1):(this.ctx.currentSpecGroup.order=e.value.order,this.ctx.currentSpecGroup.secondaryOrder=e.value.secondaryOrder,!0)}}return!1}processParsedSortGroupSpec(e){if(this.ctx.currentSpec||(this.ctx.currentSpec=this.putNewSpecForNewTargetFolder()),e.plainSpec&&(e.arraySpec=this.convertPlainStringSortingGroupSpecToArraySpec(e.plainSpec),delete e.plainSpec),e.itemToHide)return this.consumeParsedItemToHide(e)?!0:(this.problem(12,"For hiding of file or folder, the exact name with ext is required and no numeric sorting indicator allowed"),!1);{let r=this.consumeParsedSortingGroupSpec(e);return r&&this.adjustSortingGroupForNumericSortingSymbol(r)&&this.ctx.currentSpec?(this.ctx.currentSpec.groups.push(r),this.ctx.currentSpecGroup=r,!0):!1}}postprocessSortSpec(e){var o;e.outsidersGroupIdx=void 0,e.outsidersFilesGroupIdx=void 0,e.outsidersFoldersGroupIdx=void 0;let r,n;for(let s=0;s<e.groups.length;s++){let a=e.groups[s];a.type===0&&(a.filesOnly?b(e.outsidersFilesGroupIdx)?console.warn(`Ignoring duplicate Outsiders-files sorting group definition in sort spec for folder '${I(e.targetFoldersPaths)}'`):(e.outsidersFilesGroupIdx=s,n=!0):a.foldersOnly?b(e.outsidersFoldersGroupIdx)?console.warn(`Ignoring duplicate Outsiders-folders sorting group definition in sort spec for folder '${I(e.targetFoldersPaths)}'`):(e.outsidersFoldersGroupIdx=s,r=!0):b(e.outsidersGroupIdx)?console.warn(`Ignoring duplicate Outsiders sorting group definition in sort spec for folder '${I(e.targetFoldersPaths)}'`):(e.outsidersGroupIdx=s,r=!0,n=!0))}b(e.outsidersGroupIdx)&&(b(e.outsidersFilesGroupIdx)||b(e.outsidersFoldersGroupIdx))&&console.warn(`Inconsistent Outsiders sorting group definition in sort spec for folder '${I(e.targetFoldersPaths)}'`),n&&r||(e.outsidersGroupIdx=e.groups.length,e.groups.push({type:0}));for(let s of e.groups)s.order||(s.order=(o=e.defaultOrder)!=null?o:Ke);let i=`${Ee}/`;e.targetFoldersPaths.forEach((s,a)=>{s===Ee?e.targetFoldersPaths[a]=this.ctx.folderPath:s.startsWith(i)&&(e.targetFoldersPaths[a]=`${this.ctx.folderPath}/${s.substr(i.length)}`)})}putNewSpecForNewTargetFolder(e){let r={targetFoldersPaths:[e!=null?e:this.ctx.folderPath],groups:[]};return this.ctx.specs.push(r),this.ctx.currentSpec=void 0,this.ctx.currentSpecGroup=void 0,r}consumeParsedItemToHide(e){var r,n,i;if(((r=e.arraySpec)==null?void 0:r.length)===1){let o=e.arraySpec[0];if(!F(o)){let s=o.trim();if(s&&!pt(s)&&this.ctx.currentSpec){let a=(i=(n=this.ctx.currentSpec)==null?void 0:n.itemsToHide)!=null?i:new Set;return a.add(s),this.ctx.currentSpec.itemsToHide=a,!0}}}return!1}};var L=require("obsidian"),O="custom-sort-icon-active",k="custom-sort-icon-suspended",N="custom-sort-icon-enabled-not-applied",$="custom-sort-icon-syntax-error";function ve(){(0,L.addIcon)(O,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="currentColor"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" fill="currentColor"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="currentColor"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="currentColor"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="currentColor"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z"  fill="currentColor"/>`),(0,L.addIcon)(k,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" stroke="currentColor" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="currentColor" stroke-width="2" fill="none"/>`),(0,L.addIcon)($,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="red"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="red"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z" fill="red"/>`),(0,L.addIcon)(N,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" stroke="orange" stroke-width="2" fill="none"/>`)}var Tt={additionalSortspecFile:"",suspended:!0,statusBarEntryEnabled:!0,notificationsEnabled:!0},At="sortspec.md",De="sorting-spec",Et=1e4,U=class extends f.Plugin{showNotice(r,n){this.settings.notificationsEnabled&&new f.Notice(r,n)}readAndParseSortingSpec(){let r=this.app.metadataCache,n=!1,i=!1,o=null;this.sortSpecCache=null;let s=new H;f.Vault.recurseChildren(this.app.vault.getRoot(),a=>{var l,u,c;if(!n&&a instanceof f.TFile){let p=a,h=p.parent;if(p.name===At||p.basename===h.name||p.basename===this.settings.additionalSortspecFile||p.path===this.settings.additionalSortspecFile||p.path===this.settings.additionalSortspecFile+".md"){let m=(u=(l=r.getCache(p.path))==null?void 0:l.frontmatter)==null?void 0:u[De];m&&(i=!0,this.sortSpecCache=s.parseSortSpecFromText(m.split(`
`),h.path,p.name,this.sortSpecCache),this.sortSpecCache===null&&(n=!0,o=(c=s.recentErrorMessage)!=null?c:""))}}}),this.sortSpecCache?this.showNotice("Parsing custom sorting specification SUCCEEDED!"):(i?o=o||`No valid '${De}:' key(s) in YAML front matter or multiline YAML indentation error or general YAML syntax error`:o="No custom sorting specification found or only empty specification(s)",this.showNotice(`Parsing custom sorting specification FAILED. Suspending the plugin.
${o}`,Et),this.settings.suspended=!0,this.saveSettings())}switchPluginStateTo(r,n=!0){this.settings.suspended=!r,this.saveSettings();let i;this.settings.suspended?(this.showNotice("Custom sort OFF"),this.sortSpecCache=null,i=k):(this.readAndParseSortingSpec(),this.sortSpecCache?(this.showNotice("Custom sort ON"),this.initialAutoOrManualSortingTriggered=!0,i=O):(i=$,this.settings.suspended=!0,this.saveSettings()));let o=this.getFileExplorer();o?(this.fileExplorerFolderPatched||(this.fileExplorerFolderPatched=this.patchFileExplorerFolder(o)),this.fileExplorerFolderPatched&&o.requestSort()):i===O&&(i=N,n&&(this.ribbonIconStateInaccurate=!0)),n&&(0,f.setIcon)(this.ribbonIconEl,i),this.updateStatusBar()}async onload(){console.log(`loading custom-sort v${this.manifest.version}`),await this.loadSettings(),this.settings.statusBarEntryEnabled&&(this.statusBarItemEl=this.addStatusBarItem(),this.updateStatusBar()),ve(),this.ribbonIconEl=this.addRibbonIcon(this.settings.suspended?k:N,"Toggle custom sorting",r=>{this.switchPluginStateTo(this.settings.suspended)}),this.settings.suspended||(this.ribbonIconStateInaccurate=!0),this.addSettingTab(new te(this.app,this)),this.registerEventHandlers(),this.registerCommands(),this.initialize()}registerEventHandlers(){let r=this;this.registerEvent(this.app.metadataCache.on("resolved",()=>{if(!this.settings.suspended&&!this.initialAutoOrManualSortingTriggered)if(this.readAndParseSortingSpec(),this.initialAutoOrManualSortingTriggered=!0,this.sortSpecCache){this.showNotice("Custom sort ON");let n=this.getFileExplorer();n?((0,f.setIcon)(this.ribbonIconEl,O),n.requestSort()):((0,f.setIcon)(this.ribbonIconEl,N),r.ribbonIconStateInaccurate=!0),this.updateStatusBar()}else this.settings.suspended=!0,(0,f.setIcon)(this.ribbonIconEl,$),this.saveSettings()}))}registerCommands(){let r=this;this.addCommand({id:"enable-custom-sorting",name:"Enable and apply the custom sorting, (re)parsing the sorting configuration first. Sort-on.",callback:()=>{r.switchPluginStateTo(!0,!0)}}),this.addCommand({id:"suspend-custom-sorting",name:"Suspend the custom sorting. Sort-off.",callback:()=>{r.switchPluginStateTo(!1,!0)}})}initialize(){this.app.workspace.onLayoutReady(()=>{this.fileExplorerFolderPatched=this.patchFileExplorerFolder()})}patchFileExplorerFolder(r){let n=this;if(r=r!=null?r:this.getFileExplorer(),r){let i=new f.TFolder(f.Vault,""),o=r.createFolderDom(i).constructor,s=le(o.prototype,{sort(a){return function(...l){var p,h,m;if(n.settings.suspended)return a.call(this,...l);n.ribbonIconStateInaccurate&&n.ribbonIconEl&&(n.ribbonIconStateInaccurate=!1,(0,f.setIcon)(n.ribbonIconEl,O));let u=this.file,c=(p=n.sortSpecCache)==null?void 0:p.sortSpecByPath[u.path];return c?c.defaultOrder===11&&(c=null):(h=n.sortSpecCache)!=null&&h.sortSpecByWildcard&&(c=(m=n.sortSpecCache)==null?void 0:m.sortSpecByWildcard.folderMatch(u.path),(c==null?void 0:c.defaultOrder)===11&&(c=null)),c?ge.call(this,c,...l):a.call(this,...l)}}});return this.register(s),!0}else return!1}getFileExplorer(){var n,i;return(i=(n=this.app.workspace.getLeavesOfType("file-explorer"))==null?void 0:n.first())==null?void 0:i.view}onunload(){}updateStatusBar(){this.statusBarItemEl&&this.statusBarItemEl.setText(`Custom sort:${this.settings.suspended?"OFF":"ON"}`)}async loadSettings(){this.settings=Object.assign({},Tt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},te=class extends f.PluginSettingTab{constructor(r,n){super(r,n);this.plugin=n}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Settings for Custom File Explorer Sorting Plugin"}),new f.Setting(r).setName("Path to the designated note containing sorting specification").setDesc("The YAML front matter of this note will be scanned for sorting specification, in addition to the `sortspec` notes and folder notes. The `.md` filename suffix is optional.").addText(n=>n.setPlaceholder("e.g. Inbox/sort").setValue(this.plugin.settings.additionalSortspecFile).onChange(async i=>{this.plugin.settings.additionalSortspecFile=i.trim()?(0,f.normalizePath)(i):"",await this.plugin.saveSettings()})),new f.Setting(r).setName("Enable the status bar entry").setDesc("The status bar entry shows the label `Custom sort:ON` or `Custom sort:OFF`, representing the current state of the plugin.").addToggle(n=>n.setValue(this.plugin.settings.statusBarEntryEnabled).onChange(async i=>{this.plugin.settings.statusBarEntryEnabled=i,i?(this.plugin.statusBarItemEl&&this.plugin.statusBarItemEl.detach(),this.plugin.statusBarItemEl=this.plugin.addStatusBarItem(),this.plugin.updateStatusBar()):this.plugin.statusBarItemEl&&this.plugin.statusBarItemEl.detach(),await this.plugin.saveSettings()})),new f.Setting(r).setName("Enable notifications of plugin state changes").setDesc("The plugin can show notifications about its state changes: e.g. when successfully parsed and applied the custom sorting specification, or, when the parsing failed. If the notifications are disabled, the only indicator of plugin state is the ribbon button icon. The developer console presents the parsing error messages regardless if the notifications are enabled or not.").addToggle(n=>n.setValue(this.plugin.settings.notificationsEnabled).onChange(async i=>{this.plugin.settings.notificationsEnabled=i,await this.plugin.saveSettings()}))}};
